(self.webpackChunksite=self.webpackChunksite||[]).push([[8289],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=i,f=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(f,o(o({ref:t},p),{},{components:n})):a.createElement(f,o({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var u=2;u<r;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6742:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(9756),i=n(7294),r=n(3727),o=n(2263),l=n(3919),s=n(412),u=(0,i.createContext)({collectLink:function(){}}),p=n(4996),c=n(8780),d=["isNavLink","to","href","activeClassName","isActive","data-noBrokenLinkCheck","autoAddBaseUrl"];var m=function(e){var t,n,m=e.isNavLink,f=e.to,g=e.href,k=e.activeClassName,h=e.isActive,x=e["data-noBrokenLinkCheck"],w=e.autoAddBaseUrl,y=void 0===w||w,N=(0,a.Z)(e,d),v=(0,o.Z)().siteConfig,T=v.trailingSlash,b=v.baseUrl,C=(0,p.C)().withBaseUrl,P=(0,i.useContext)(u),_=f||g,S=(0,l.Z)(_),A=null==_?void 0:_.replace("pathname://",""),O=void 0!==A?(n=A,y&&function(e){return e.startsWith("/")}(n)?C(n):n):void 0;O&&S&&(O=(0,c.applyTrailingSlash)(O,{trailingSlash:T,baseUrl:b}));var R,L=(0,i.useRef)(!1),I=m?r.OL:r.rU,B=s.Z.canUseIntersectionObserver;(0,i.useEffect)((function(){return!B&&S&&null!=O&&window.docusaurus.prefetch(O),function(){B&&R&&R.disconnect()}}),[O,B,S]);var E=null!==(t=null==O?void 0:O.startsWith("#"))&&void 0!==t&&t,D=!O||!S||E;return O&&S&&!E&&!x&&P.collectLink(O),D?i.createElement("a",Object.assign({href:O},_&&!S&&{target:"_blank",rel:"noopener noreferrer"},N)):i.createElement(I,Object.assign({},N,{onMouseEnter:function(){L.current||null==O||(window.docusaurus.preload(O),L.current=!0)},innerRef:function(e){var t,n;B&&e&&S&&(t=e,n=function(){null!=O&&window.docusaurus.prefetch(O)},(R=new window.IntersectionObserver((function(e){e.forEach((function(e){t===e.target&&(e.isIntersecting||e.intersectionRatio>0)&&(R.unobserve(t),R.disconnect(),n())}))}))).observe(t))},to:O||""},m&&{isActive:h,activeClassName:k}))}},3919:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!a(e)}n.d(t,{b:function(){return a},Z:function(){return i}})},4996:function(e,t,n){"use strict";n.d(t,{C:function(){return r},Z:function(){return o}});var a=n(2263),i=n(3919);function r(){var e=(0,a.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,r=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,a){var r=void 0===a?{}:a,o=r.forcePrependBaseUrl,l=void 0!==o&&o,s=r.absolute,u=void 0!==s&&s;if(!n)return n;if(n.startsWith("#"))return n;if((0,i.b)(n))return n;if(l)return t+n;var p=n.startsWith(t)?n:t+n.replace(/^\//,"");return u?e+p:p}(r,n,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,r().withBaseUrl)(e,t)}},9443:function(e,t,n){"use strict";var a=(0,n(7294).createContext)(void 0);t.Z=a},8802:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.trailingSlash,a=t.baseUrl;if(e.startsWith("#"))return e;if(void 0===n)return e;var i,r=e.split(/[#?]/)[0],o="/"===r||r===a?r:(i=r,n?function(e){return e.endsWith("/")?e:e+"/"}(i):function(e){return e.endsWith("/")?e.slice(0,-1):e}(i));return e.replace(r,o)}},8780:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.uniq=t.applyTrailingSlash=void 0;var i=n(8802);Object.defineProperty(t,"applyTrailingSlash",{enumerable:!0,get:function(){return a(i).default}});var r=n(9964);Object.defineProperty(t,"uniq",{enumerable:!0,get:function(){return a(r).default}})},9964:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Array.from(new Set(e))}},2375:function(e,t,n){"use strict";n.d(t,{T:function(){return d},Z:function(){return m}});var a=n(7294),i=n(6742),r=n(5977),o=n(6010),l=n(9443);var s=function(){var e=(0,a.useContext)(l.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},u={assemblyscript:"AssemblyScript",c:"C / C++",c3:"C3",d:"D",go:"Go",grain:"Grain",nelua:"Nelua",nim:"Nim",odin:"Odin",penne:"Penne",porth:"Porth",roland:"Roland",rust:"Rust",wat:"WebAssembly Text",zig:"Zig"};function p(e){return"string"==typeof e&&Object.prototype.hasOwnProperty.call(u,e)}function c(e){return(null!=e?e:"").trim().toLowerCase()}function d(e){var t=e.children,n=e.hidden,i=e.className;return a.createElement("div",{hidden:n,className:i},t)}function m(e){var t=a.Children.toArray(e.children),n=t.map((function(e){return e.props.value})),l=function(){var e=s(),t=e.tabGroupChoices,n=e.setTabGroupChoices,i=(0,a.useState)("assemblyscript"),r=i[0],o=i[1],l=function(e){var t=p(e);t?(o(e),n("language",e)):t||console.warn('MultilanguageCode: invalid code-lang received: "'+e+'"')},u=(0,a.useRef)(l);(0,a.useEffect)((function(){u.current=l}));var d="undefined"!=typeof window?window.location.search:"",m=t.language;return(0,a.useLayoutEffect)((function(){var e=c(m);p(e)&&o(e)}),[m]),(0,a.useEffect)((function(){var e=c(new URLSearchParams(d).get("code-lang"));p(e)&&u.current(e)}),[d]),{activeLang:r,updateLang:l}}().activeLang,d=(0,r.k6)(),m=n.includes(l)?l:n.includes("assemblyscript")?"assemblyscript":n[0],f=a.createElement("div",{className:"dropdown dropdown--hoverable dropdown--right"},a.createElement("a",{className:"navbar__link"},u[m]," "),a.createElement("ul",{className:"dropdown__menu text--left"},Object.entries(u).filter((function(e){return n.includes(e[0])})).map((function(e){var t=e[0],n=e[1],r=d.location.pathname+"?code-lang="+t+(d.location.hash||"#no-scroll");return a.createElement("li",{key:t},a.createElement(i.Z,{to:r,replace:!0,className:(0,o.Z)("dropdown__link",t===m&&"dropdown__link--active")},n))}))));return a.createElement("div",null,a.createElement("div",{className:"multilang"},f),a.createElement("div",null,t.map((function(e){return(0,a.cloneElement)(e,{key:e.props.value,hidden:e.props.value!==m})}))))}},6329:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return u},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var a=n(2122),i=n(9756),r=(n(7294),n(3905)),o=n(2375),l=["components"],s={},u="Placing the Fruit",p={unversionedId:"tutorials/snake/placing-the-fruit",id:"tutorials/snake/placing-the-fruit",isDocsHomePage:!1,title:"Placing the Fruit",description:"A freely moving snake is nice. But it get's a bit dull if that's all there is. To make it a bit more of a challenge, you'd need to add something to change the snake. The classic approach is to let the snake \"eat\" fruits. That's a good place to start.",source:"@site/docs/tutorials/snake/placing-the-fruit.md",sourceDirName:"tutorials/snake",slug:"/tutorials/snake/placing-the-fruit",permalink:"/wasm4/docs/tutorials/snake/placing-the-fruit",editUrl:"https://github.com/aduros/wasm4/edit/main/site/docs/tutorials/snake/placing-the-fruit.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"User Input",permalink:"/wasm4/docs/tutorials/snake/handling-user-input"},next:{title:"Collision Detection",permalink:"/wasm4/docs/tutorials/snake/collision-detection"}},c=[{value:"Random Numbers",id:"random-numbers",children:[]},{value:"Importing PNG Files",id:"importing-png-files",children:[]},{value:"Rendering a PNG File",id:"rendering-a-png-file",children:[]}],d={toc:c};function m(e){var t=e.components,s=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"placing-the-fruit"},"Placing the Fruit"),(0,r.kt)("p",null,"A freely moving snake is nice. But it get's a bit dull if that's all there is. To make it a bit more of a challenge, you'd need to add something to change the snake. The classic approach is to let the snake \"eat\" fruits. That's a good place to start."),(0,r.kt)(o.Z,{mdxType:"MultiLanguage"},(0,r.kt)(o.T,{value:"assemblyscript",mdxType:"Page"},"To place (and eat) a fruit, you first need to make a variable for this. Since it's simply a point on the grid, `Point` will do:",(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{2}","{2}":!0},"const snake = new Snake()\nlet fruit: Point\nlet prevState: u8\nlet frameCount = 0\n"))),(0,r.kt)(o.T,{value:"c",mdxType:"Page"},(0,r.kt)("p",null,"To place (and eat) a fruit, you first need to make a variable for this. Since it's simply a point on the grid, a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct point")," will do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:"{4}","{4}":!0},"struct snake snake;\nint frame_count = 0;\nuint8_t prev_state = 0;\nstruct point fruit;\n"))),(0,r.kt)(o.T,{value:"d",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"go",mdxType:"Page"},(0,r.kt)("p",null,"To place (and eat) a fruit, you first need to make a variable for this. Since it's simply a point on the grid, ",(0,r.kt)("inlineCode",{parentName:"p"},"Point")," will do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"{3}","{3}":!0},"    frameCount = 0\n    prevState  uint8\n    fruit      Point\n"))),(0,r.kt)(o.T,{value:"nelua",mdxType:"Page"},"To place (and eat) a fruit, you first need to make a variable for this. Since it's simply a point on the grid, `Point` will do.",(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{6}","{6}":!0},'require "wasm4"\nlocal Snake = require "snake"\nlocal Point, Snake = Snake.Point, Snake.Snake\n\nlocal snake = Snake.init()\nlocal fruit: Point\nlocal frame_count = 0\nlocal prev_state = 0\n'))),(0,r.kt)(o.T,{value:"nim",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"odin",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"porth",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"rust",mdxType:"Page"},(0,r.kt)("p",null,"To place (and eat) a fruit, you first need to define it in ",(0,r.kt)("inlineCode",{parentName:"p"},"Game"),". Since it's simply a point on the grid, ",(0,r.kt)("inlineCode",{parentName:"p"},"Point")," will do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:"{8,16}","{8,16}":!0},"// src/game.rs\nuse crate::snake::{Point, Snake};\nuse crate::wasm4;\n\npub struct Game {\n    snake: Snake,\n    frame_count: u32,\n    fruit: Point,\n}\n\nimpl Game {\n    pub fn new() -> Self {\n        Self {\n            snake: Snake::new(),\n            frame_count: 0,\n            fruit: Point { x: 0, y: 0 },\n        }\n    }\n}\n"))),(0,r.kt)(o.T,{value:"wat",mdxType:"Page"},"To place (and eat) a fruit, you first need to make a variable for this. Since it's simply a point on the grid, a point will do.",(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},";; snake.direction   = 0x19a0\n;; snake.body_length = 0x19a8\n;; snake.body        = 0x19ac\n;; frame_count       = 0x262c\n;; fruit             = 0x2630\n"))),(0,r.kt)(o.T,{value:"zig",mdxType:"Page"},"To place (and eat) a fruit, you first need to make a variable for this. Since it's simply a point on the grid, `Point` will do. Set it to undefined for now:",(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{3,6}","{3,6}":!0},'const w4 = @import("wasm4.zig");\nconst Snake = @import("snake.zig").Snake;\nconst Point = @import("snake.zig").Point;\n\nvar snake = Snake.init();\nvar fruit: Point = undefined;\nvar frame_count: u32 = 0;\nvar prev_state: u8 = 0;\n')))),(0,r.kt)("h2",{id:"random-numbers"},"Random Numbers"),(0,r.kt)(o.Z,{mdxType:"MultiLanguage"},(0,r.kt)(o.T,{value:"assemblyscript",mdxType:"Page"},(0,r.kt)("p",null,"AssemblyScript provides us with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Math.random")," function. It returns a floating point value between ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"0.999999999"),". But since we only deal with integer values, it's a good idea to create a helper function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"function rnd(n: i32 = 20): u16 {\n    return u16(Math.floor(Math.random() * n))\n}\n")),(0,r.kt)("p",null,"This allows you to call ",(0,r.kt)("inlineCode",{parentName:"p"},"rnd(20)")," to get a number between ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"19"),". Now you can change the fruit declaration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{2}","{2}":!0},"const snake = new Snake()\nconst fruit = new Point(rnd(20), rnd(20))\nlet prevState: u8\nlet frameCount = 0\n"))),(0,r.kt)(o.T,{value:"c",mdxType:"Page"},(0,r.kt)("p",null,"C provides us with pretty much everything we could need to create random numbers. Since we have already included ",(0,r.kt)("inlineCode",{parentName:"p"},"stdlib.h")," we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"rand")," function to generate random numbers. ",(0,r.kt)("inlineCode",{parentName:"p"},"rand()")," returns and ",(0,r.kt)("inlineCode",{parentName:"p"},"int")," between ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"RAND_MAX")," which is guaranteed to be at least a 16-bit value. To limit the value returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"rand()")," to the screen grid coordinates we can divide it by ",(0,r.kt)("inlineCode",{parentName:"p"},"20")," and use the remainder as our value using the modulus operator:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"fruit.x = rand()%20;\nfruit.y = rand()%20;\n")),(0,r.kt)("p",null,"As we can not use the system time to seed our random function, we need to explore some other ways of randomizing our fruit placement: as it stands every time we run the game the fruit will always appear at the same locations and the same sequence. In order to seed the random number generator we need a value that will be different every time the game starts, unfortunately we do not have access to any but once the game starts we can use a combination of the ",(0,r.kt)("inlineCode",{parentName:"p"},"frame_count")," and user input to seed the randomness as the user will not always press the button at the exact same time."),(0,r.kt)("p",null,"To set the seed when the user inputs something, add the following line of code at the start of the ",(0,r.kt)("inlineCode",{parentName:"p"},"input")," function in ",(0,r.kt)("inlineCode",{parentName:"p"},"main.c"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:"{3}","{3}":!0},"void input()\n{\n    srand(frame_count);\n    \n    ...\n")),(0,r.kt)("p",null,"The initial fruit placement will be the same every run, but subsequent placements will be based off of this seed which should hopefully be unique each time.")),(0,r.kt)(o.T,{value:"d",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"go",mdxType:"Page"},(0,r.kt)("p",null,"Go provides us with pretty much everything we could need to create random numbers. The package ",(0,r.kt)("inlineCode",{parentName:"p"},"math/rand")," contains a handy function: ",(0,r.kt)("inlineCode",{parentName:"p"},"Intn(n int) int"),". It takes an integer and returns a random value between 0 and n-1. If you think, placing something like this in ",(0,r.kt)("inlineCode",{parentName:"p"},"start")," would be a good idea:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"    fruit.X = rand(20)\n    fruit.Y = rand(20)\n")),(0,r.kt)("p",null,"You'd be surprised that this pretty much crashes. So we can't use the standard random-functions of Go? No, we can. We just have to make our own instance of the number generator:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"{4}","{4}":!0},"    frameCount = 0\n    prevState  uint8\n    fruit      Point\n    rnd        func(int) int\n")),(0,r.kt)("p",null,"Now you can use it like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"    rnd = rand.New(rand.NewSource(1)).Intn\n    fruit.X = rnd(20)\n    fruit.Y = rnd(20)\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," is the seed. But having a fixed seed is not a good idea. You might be tempted to use ",(0,r.kt)("inlineCode",{parentName:"p"},"time.Now().Unix()"),". But this will crash the came with a nice ",(0,r.kt)("inlineCode",{parentName:"p"},"field 'runtime.ticks' is not a Function"),"."),(0,r.kt)("p",null,"Since the standard ",(0,r.kt)("inlineCode",{parentName:"p"},"time")," is not an option, how about you use something that is time related and is already in your project? Like ",(0,r.kt)("inlineCode",{parentName:"p"},"frameCount"),"?"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"    rnd = rand.New(rand.NewSource(int64(frameCount))).Intn\n    fruit.X = rnd(20)\n    fruit.Y = rnd(20)\n")),(0,r.kt)("p",null,"Works. But since this is the ",(0,r.kt)("inlineCode",{parentName:"p"},"start"),"-function, ",(0,r.kt)("inlineCode",{parentName:"p"},"frameCount")," is pretty much always ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),". That's why here's a small exercise for you: change the seed after the first key was pressed."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Check the for nil")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Keep in mind, that the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"rnd")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"nil")," if it wasn't initialized yet.")))),(0,r.kt)(o.T,{value:"nelua",mdxType:"Page"},(0,r.kt)("p",null,"Nelua provides us a ",(0,r.kt)("inlineCode",{parentName:"p"},"math")," library with a ",(0,r.kt)("inlineCode",{parentName:"p"},"random")," function, which when called with two integers ",(0,r.kt)("inlineCode",{parentName:"p"},"m")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"n")," it returns a pseudo-random integer with uniform distribution in the range ","[",(0,r.kt)("inlineCode",{parentName:"p"},"m"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"n"),"]",".\nThis allows you to call ",(0,r.kt)("inlineCode",{parentName:"p"},"math.random(0, 19)")," to get a number between ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"19"),". Now you can change the fruit declaration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{1, 4}","{1,":!0,"4}":!0},"local math = require 'math'\n\nlocal snake = Snake.init()\nlocal fruit: Point = { x = math.random(0, 19), y = math.random(0,19) }\nlocal frame_count = 0\nlocal prev_state = 0\n"))),(0,r.kt)(o.T,{value:"nim",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"odin",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"porth",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"rust",mdxType:"Page"},(0,r.kt)("p",null,"There are several random random generators available on ",(0,r.kt)("a",{parentName:"p",href:"https://crates.io"},"crates.io"),", including some that are cryptographically secure."),(0,r.kt)("p",null,"We don't need anything our snake game to be cryptographically secure so we'll use ",(0,r.kt)("a",{parentName:"p",href:"https://crates.io/crates/fastrand"},(0,r.kt)("inlineCode",{parentName:"a"},"fastrand"))," crate:"),(0,r.kt)("p",null,"it provides ",(0,r.kt)("a",{parentName:"p",href:"https://docs.rs/fastrand/1.6.0/fastrand/"},(0,r.kt)("inlineCode",{parentName:"a"},"fastrand::Rng")),", a simple seedable pseudo-random number generator."),(0,r.kt)("p",null,"Let's add ",(0,r.kt)("inlineCode",{parentName:"p"},"fastrand")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"Cargo.toml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-toml",metastring:"{4}","{4}":!0},'[dependencies]\nbuddy-alloc = { version = "0.4.1", optional = true }\nlazy_static = "1.4.0"\nfastrand = "1.6.0"\n')),(0,r.kt)("p",null,"We'll then store an instance of ",(0,r.kt)("inlineCode",{parentName:"p"},"fastrand::Rng")," in our ",(0,r.kt)("inlineCode",{parentName:"p"},"Game")," and initialize fruit coordinates with\n",(0,r.kt)("a",{parentName:"p",href:"https://docs.rs/fastrand/1.6.0/fastrand/struct.Rng.html#method.i32"},"Rng::i32"),":"),(0,r.kt)("p",null,"a method that returns a random ",(0,r.kt)("inlineCode",{parentName:"p"},"i32")," number within the input range."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:"{7,15,22-23,25}","{7,15,22-23,25}":!0},"// src/game.rs\nuse crate::snake::{Point, Snake};\nuse crate::wasm4;\nuse fastrand::Rng;\n\npub struct Game {\n    rng: Rng,\n    snake: Snake,\n    frame_count: u32,\n    fruit: Point,\n}\n\nimpl Game {\n    pub fn new() -> Self {\n        let rng = Rng::with_seed(235);\n\n        Self {\n            frame_count: 0,\n            snake: Snake::new(),\n            prev_gamepad: 0,\n            fruit: Point {\n                x: rng.i32(0..20),\n                y: rng.i32(0..20),\n            },\n            rng,\n        }\n    }\n}\n"))),(0,r.kt)(o.T,{value:"wat",mdxType:"Page"},(0,r.kt)("p",null,"The WebAssembly text format doesn't provide any random number generator, so we'll have to write our own. ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Xorshift"},"Xorshift")," is a reasonable choice."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},";; Initialize the random state to 1234.\n(global $random-state (mut i32) (i32.const 1234))\n\n(func $rnd (param $n i32) (result i32)\n  (local $x i32)\n\n  ;; x = random-state\n  ;; x ^= x << 13\n  ;; x ^= x >> 17\n  ;; x ^= x << 5\n  ;; random-state = x\n  (global.set $random-state\n    (local.tee $x\n      (i32.xor\n        (local.tee $x\n          (i32.xor\n            (local.tee $x\n              (i32.xor\n                (local.tee $x (global.get $random-state))\n                (i32.shl\n                  (local.get $x)\n                  (i32.const 13))))\n            (i32.shr_u\n              (local.get $x)\n              (i32.const 17))))\n        (i32.shl\n          (local.get $x)\n          (i32.const 5)))))\n\n  ;; convert a random i32 in the range [0, 2**32) to a random f32 in the range\n  ;; [0, 1). Then multiply by `n` to convert it to a f32 in the range [0, n).\n  ;; Finally convert it back to an i32.\n  (i32.trunc_f32_u\n    (f32.mul\n      (f32.mul\n        (f32.convert_i32_u (i32.shr_u (local.get $x) (i32.const 8)))\n        (f32.const 0x1p-24))\n      (f32.convert_i32_u\n        (local.get $n))))\n)\n")),(0,r.kt)("p",null,"This allows you to call ",(0,r.kt)("inlineCode",{parentName:"p"},"rnd(20)")," to get a number between ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"19"),". Now you can randomly initialize the fruit position:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},'(func (export "start")\n  (i32.store (global.get $PALETTE0) (i32.const 0xfbf7f3))\n  (i32.store (global.get $PALETTE1) (i32.const 0xe5b083))\n  (i32.store (global.get $PALETTE2) (i32.const 0x426e5d))\n  (i32.store (global.get $PALETTE3) (i32.const 0x20283d))\n\n  ;; fruit.x = rnd(20)\n  (i32.store (i32.const 0x2630) (call $rnd (i32.const 20)))\n\n  ;; fruit.y = rnd(20)\n  (i32.store (i32.const 0x2634) (call $rnd (i32.const 20)))\n)\n'))),(0,r.kt)(o.T,{value:"zig",mdxType:"Page"},(0,r.kt)("p",null,"Zig's standard library has a couple of different random number generators, including some that are meant to be cryptographically secure. We don't need anything our snake game to be cryptographically secure, so we'll just use ",(0,r.kt)("inlineCode",{parentName:"p"},"std.rand.DefaultPrng"),", where Prng means pseudo-random number generator. To start, we'll need to import ",(0,r.kt)("inlineCode",{parentName:"p"},"std")," and initialize the prng:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{2,10-11,20-21}","{2,10-11,20-21}":!0},'const w4 = @import("wasm4.zig");\nconst std = @import("std");\nconst Snake = @import("snake.zig").Snake;\nconst Point = @import("snake.zig").Point;\n\nvar snake = Snake.init();\nvar fruit: Point = undefined;\nvar frame_count: u32 = 0;\nvar prev_state: u8 = 0;\nvar prng: std.rand.DefaultPrng = undefined;\nvar random: std.rand.Random = undefined;\n\nexport fn start() void {\n    w4.PALETTE.* = .{\n        0xfbf7f3,\n        0xe5b083,\n        0x426e5d,\n        0x20283d,\n    };\n    prng = std.rand.DefaultPrng.init(0);\n    random = prng.random();\n}\n\n')),(0,r.kt)("p",null,"We can call ",(0,r.kt)("inlineCode",{parentName:"p"},"random.intRangeLessThan(T, at_least, less_than)")," to get a number between ",(0,r.kt)("inlineCode",{parentName:"p"},"at_least")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"less_than"),", with the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"T"),". You can wrap that in a helper function if you'd like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig"},"fn rnd(max: i32) i32 {\n    return random.intRangeLessThan(i32, 0, max);\n}\n")),(0,r.kt)("p",null,"Now use it for the location of the fruit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{10}","{10}":!0},"export fn start() void {\n    w4.PALETTE.* = .{\n        0xfbf7f3,\n        0xe5b083,\n        0x426e5d,\n        0x20283d,\n    };\n    prng = std.rand.DefaultPrng.init(0);\n    random = prng.random();\n    fruit = Point.init(rnd(20), rnd(20));\n}\n")))),(0,r.kt)("h2",{id:"importing-png-files"},"Importing PNG Files"),(0,r.kt)("p",null,"Importing images in WASM-4 works a bit different compared to other game engines and Fantasy Consoles. Images have to meet certain criteria:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"PNG only"),(0,r.kt)("li",{parentName:"ul"},"Index only"),(0,r.kt)("li",{parentName:"ul"},"4 colors max")),(0,r.kt)("p",null,"Indexed PNG files can be created by several image apps like ",(0,r.kt)("a",{parentName:"p",href:"https://www.aseprite.org/"},"Aseprite")," or ",(0,r.kt)("a",{parentName:"p",href:"https://www.gimp.org/"},"GIMP"),"."),(0,r.kt)("p",null,"The image we import is a 8x8 PNG file with exactly 4 colors:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Zoomed Fruit",src:n(6221).Z}),"\nThis image is zoomed by 800%."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Zoomed Fruit",src:n(987).Z}),"\nThis is the original image. You can download it to proceed."),(0,r.kt)(o.Z,{mdxType:"MultiLanguage"},(0,r.kt)(o.T,{value:"assemblyscript",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --assemblyscript fruit.png")),(0,r.kt)("p",null,"This will output the following content in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const fruitWidth = 8;\nconst fruitHeight = 8;\nconst fruitFlags = 1; // BLIT_2BPP\nconst fruit = memory.data<u8>([ 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 ]);\n")),(0,r.kt)("p",null,"To get it into a an existing file, use the ",(0,r.kt)("inlineCode",{parentName:"p"},">>")," operator. Like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --assemblyscript fruit.png >> main.ts")),(0,r.kt)("p",null,"This will add the previous lines to your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.ts"),' and causes an error because "fruit" already exists. Just rename the new fruit to ',(0,r.kt)("inlineCode",{parentName:"p"},"fruitSprite")," and move it somewhere else. Also: You can remove the other stuff added, you won't need it for this project:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{2}","{2}":!0},"const snake = new Snake()\nconst fruit = new Point(rnd(20), rnd(20))\nlet frameCount = 0\nlet prevState: u8\nconst fruitSprite = memory.data<u8>([ 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 ])\n")),(0,r.kt)("p",null,"With that out of the way, it's time to actually render the newly imported sprite.")),(0,r.kt)(o.T,{value:"c",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --c fruit.png")),(0,r.kt)("p",null,"This will output some code ending in the following to the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"const uint8_t fruit_sprite[] = {\n    0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0\n};\n")),(0,r.kt)("p",null,"We need to add that array to the top of our ",(0,r.kt)("inlineCode",{parentName:"p"},"main.c")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:"{9-11}","{9-11}":!0},'#include "wasm4.h"\n#include "snake.h"\n#include <stdlib.h>\n\nstruct snake snake;\nint frame_count = 0;\nuint8_t prev_state = 0;\nstruct point fruit;\nconst uint8_t fruit_sprite[] = {\n    0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0\n};\n')),(0,r.kt)("p",null,"With that out of the way, it's time to actually render the newly imported sprite.")),(0,r.kt)(o.T,{value:"d",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"go",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --go fruit.png")),(0,r.kt)("p",null,"This will output the following content in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"const fruitWidth = 8\nconst fruitHeight = 8\nconst fruitFlags = 1 // BLIT_2BPP\nvar fruit = [16]byte { 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 }\n")),(0,r.kt)("p",null,"To get it into a an existing file, use the ",(0,r.kt)("inlineCode",{parentName:"p"},">>")," operator. Like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --go fruit.png >> main.go")),(0,r.kt)("p",null,"This will add the previous lines to your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.go"),' and causes an error because "fruit" already exists. Just rename the new fruit to ',(0,r.kt)("inlineCode",{parentName:"p"},"fruitSprite")," and move it somewhere else. Also: You can remove the other stuff added, you won't need it for this project:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"{5}","{5}":!0},"    frameCount  = 0\n    prevState   uint8\n    fruit       Point\n    rnd         func(int) int\n    fruitSprite = [16]byte{0x00, 0xa0, 0x02, 0x00, 0x0e, 0xf0, 0x36, 0x5c, 0xd6, 0x57, 0xd5, 0x57, 0x35, 0x5c, 0x0f, 0xf0}\n")),(0,r.kt)("p",null,"With that out of the way, it's time to actually render the newly imported sprite.")),(0,r.kt)(o.T,{value:"nelua",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --nelua fruit.png")),(0,r.kt)("p",null,"This will output the following content in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},"-- fruit\nlocal fruit_width <comptime> = 8\nlocal fruit_height <comptime> = 8\nlocal fruit_flags <comptime> = 1 -- BLIT_2BPP\nlocal fruit: [16]uint8 = { 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 }\n")),(0,r.kt)("p",null,"To get it into a an existing file, use the ",(0,r.kt)("inlineCode",{parentName:"p"},">>")," operator. Like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --nelua fruit.png >> main.nelua")),(0,r.kt)("p",null,"This will add the previous lines to your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.nelua")," and it will shadow the previous ",(0,r.kt)("inlineCode",{parentName:"p"},"fruit")," variable. Just rename the new fruit to ",(0,r.kt)("inlineCode",{parentName:"p"},"fruit_sprite")," and move it somewhere else. Also: You can remove the other stuff added, you won't need it for this project:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{5}","{5}":!0},"local snake = Snake.init()\nlocal fruit: Point = { x = math.random(0, 19), y = math.random(0,19) }\nlocal frame_count = 0\nlocal prev_state = 0\nlocal fruit_sprite: [16]uint8 = { 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 }\n")),(0,r.kt)("p",null,"With that out of the way, it's time to actually render the newly imported sprite.")),(0,r.kt)(o.T,{value:"nim",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"odin",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"porth",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"rust",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"w4 png2src --rust fruit.png\n")),(0,r.kt)("p",null,"This will output the following content in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"const FRUIT_WIDTH: u32 = 8;\nconst FRUIT_HEIGHT: u32 = 8;\nconst FRUIT_FLAGS: u32 = 1; // BLIT_2BPP\nconst FRUIT: [u8; 16] = [ 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 ];\n")),(0,r.kt)("p",null,"Let's copy ",(0,r.kt)("inlineCode",{parentName:"p"},"FRUIT")," and add it to our project;\nwe'll also rename it ",(0,r.kt)("inlineCode",{parentName:"p"},"FRUIT_SPRITE"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:"{6-8}","{6-8}":!0},"// src/game.rs\nuse crate::snake::{Point, Snake};\nuse crate::wasm4;\nuse fastrand::Rng;\n\nconst FRUIT_SPRITE: [u8; 16] = [\n    0x00, 0xa0, 0x02, 0x00, 0x0e, 0xf0, 0x36, 0x5c, 0xd6, 0x57, 0xd5, 0x57, 0x35, 0x5c, 0x0f, 0xf0,\n];\n\npub struct Game {\n    rng: Rng,\n    snake: Snake,\n    frame_count: u32,\n    fruit: Point,\n}\n"))),(0,r.kt)(o.T,{value:"wat",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --wat fruit.png")),(0,r.kt)("p",null,"This will output the following content in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig"},';; fruit\n;; fruit_width = 8;\n;; fruit_height = 8;\n;; fruit_flags = 1; // BLIT_2BPP\n\n(data\n  (i32.const ???)\n  "\\00\\a0\\02\\00\\0e\\f0\\36\\5c\\d6\\57\\d5\\57\\35\\5c\\0f\\f0"\n)\n')),(0,r.kt)("p",null,"To get it into a an existing file, use the ",(0,r.kt)("inlineCode",{parentName:"p"},">>")," operator. Like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --wat fruit.png >> main.wat")),(0,r.kt)("p",null,"This will add the previous lines to your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.wat")," and causes an error because it doesn't know where to put the data. Let's put it at 0x2638, after the fruit position:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},'(data\n  (i32.const 0x2638)\n  "\\00\\a0\\02\\00\\0e\\f0\\36\\5c\\d6\\57\\d5\\57\\35\\5c\\0f\\f0"\n)\n')),(0,r.kt)("p",null,"With that out of the way, it's time to actually render the newly imported sprite.")),(0,r.kt)(o.T,{value:"zig",mdxType:"Page"},(0,r.kt)("p",null,"Now you need to import the image. For this, the WASM-4 CLI tool ",(0,r.kt)("inlineCode",{parentName:"p"},"w4")," comes with another tool: ",(0,r.kt)("inlineCode",{parentName:"p"},"png2src"),". You can use it like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --zig fruit.png")),(0,r.kt)("p",null,"This will output the following content in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig"},"const fruit_width = 8;\nconst fruit_height = 8;\nconst fruit_flags = 1; // BLIT_2BPP\nconst fruit = [16]u8{ 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 };\n")),(0,r.kt)("p",null,"To get it into a an existing file, use the ",(0,r.kt)("inlineCode",{parentName:"p"},">>")," operator (or copy and paste). Like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"w4 png2src --zig fruit.png >> main.zig")),(0,r.kt)("p",null,"This will add the previous lines to your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.zig"),' and causes an error because "fruit" already exists. Just rename the new fruit to ',(0,r.kt)("inlineCode",{parentName:"p"},"fruitSprite")," and move it somewhere else. Also: You can remove the other stuff added, you won't need it for this project:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{6}","{6}":!0},"var snake = Snake.init();\nvar fruit: Point = undefined;\nvar frame_count: u32 = 0;\nvar prev_state: u8 = 0;\nvar random: std.rand.Random = undefined;\nconst fruit_sprite = [16]u8{ 0x00,0xa0,0x02,0x00,0x0e,0xf0,0x36,0x5c,0xd6,0x57,0xd5,0x57,0x35,0x5c,0x0f,0xf0 };\n")),(0,r.kt)("p",null,"With that out of the way, it's time to actually render the newly imported sprite."))),(0,r.kt)("h2",{id:"rendering-a-png-file"},"Rendering a PNG File"),(0,r.kt)(o.Z,{mdxType:"MultiLanguage"},(0,r.kt)(o.T,{value:"assemblyscript",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the ",(0,r.kt)("inlineCode",{parentName:"p"},"blit")," function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// Blit draws a sprite at position `x`, `y` and uses DRAW_COLORS accordingly\nfunction blit(spritePtr: usize, x: i32, y: i32, width: u32, height: u32, flags: u32): void;\n")),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"export function update(): void {\n    frameCount++\n\n    input()\n\n    if (frameCount % 15 == 0) {\n        snake.update()\n    }\n    snake.draw()\n\n    w4.blit(fruitSprite, fruit.x * 8, fruit.y * 8, 8, 8, w4.BLIT_2BPP)\n}\n")),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{3}","{3}":!0},"    snake.draw()\n\n    store<u16>(w4.DRAW_COLORS, 0x4320)\n    w4.blit(fruitSprite, fruit.x * 8, fruit.y * 8, 8, 8, w4.BLIT_2BPP)\n")),(0,r.kt)("p",null,"This way, w4 uses the color palette in its default configuration. Except for one thing: The background will be transparent.")),(0,r.kt)(o.T,{value:"c",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the ",(0,r.kt)("inlineCode",{parentName:"p"},"blit")," function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"// blit draws a sprite at position x, y and uses DRAW_COLORS accordingly\nvoid blit (const uint8_t* data, int32_t x, int32_t y, uint32_t width, uint32_t height, uint32_t flags);\n")),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:"{14}","{14}":!0},"void update () \n{\n    frame_count++;\n\n    input();\n\n    if (frame_count % 15 == 0)\n    {\n        snake_update(&snake);\n    }\n\n    snake_draw(&snake);\n\n    blit(fruit_sprite,fruit.x*8,fruit.y*8,8,8,BLIT_2BPP);\n}\n\n")),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:"{3}","{3}":!0},"    snake_draw(&snake);\n\n    *DRAW_COLORS = 0x4320;\n    blit(fruit_sprite,fruit.x*8,fruit.y*8,8,8,BLIT_2BPP);\n")),(0,r.kt)("p",null,"This way, w4 uses the color palette in its default configuration. Except for one thing: The background will be transparent.")),(0,r.kt)(o.T,{value:"d",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"go",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the ",(0,r.kt)("inlineCode",{parentName:"p"},"Blit")," function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"// Blit draws a sprite at position X, Y and uses DRAW_COLORS accordingly\nfunc Blit(sprite *byte, x, y int, width, height, flags uint)\n")),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"{13}","{13}":!0},"//go:export update\nfunc update() {\n    frameCount++\n\n    input()\n\n    if frameCount%15 == 0 {\n        snake.Update()\n    }\n\n    snake.Draw()\n\n    w4.Blit(&fruitSprite[0], fruit.X*8, fruit.Y*8, 8, 8, w4.BLIT_2BPP)\n}\n")),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"{3}","{3}":!0},"    snake.Draw()\n\n    *w4.DRAW_COLORS = 0x4320\n    w4.Blit(&fruitSprite[0], fruit.X*8, fruit.Y*8, 8, 8, w4.BLIT_2BPP)\n")),(0,r.kt)("p",null,"This way, w4 uses the color palette in its default configuration. Except for one thing: The background will be transparent.")),(0,r.kt)(o.T,{value:"nelua",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the ",(0,r.kt)("inlineCode",{parentName:"p"},"blit")," function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},"// Blit draws a sprite at position `x`, `y` and uses DRAW_COLORS accordingly\nglobal function blit(data: *[0]uint8, x: int32, y: int32, width: uint32, height: uint32, flags: uint32)\n")),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{12}","{12}":!0},"local function update()\n  frame_count = frame_count + 1\n\n  input()\n\n  if frame_count % 15 == 0 then\n    snake:update()\n  end\n\n  snake:draw()\n\n  blit(fruit_sprite, fruit.x * 8, fruit.y * 8, 8, 8, BLIT_2BPP)\nend\n")),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{3}","{3}":!0},"  snake:draw()\n\n  $DRAW_COLORS = 0x4320\n  blit(fruit_sprite, fruit.x * 8, fruit.y * 8, 8, 8, BLIT_2BPP)\n")),(0,r.kt)("p",null,"This way, w4 uses the color palette in its default configuration. Except for one thing: The background will be transparent.")),(0,r.kt)(o.T,{value:"nim",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"odin",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"porth",mdxType:"Page"},(0,r.kt)("p",null,"// TODO")),(0,r.kt)(o.T,{value:"rust",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the blit function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn blit(sprite: &[u8], x: i32, y: i32, width: u32, height: u32, flags: u32);\n")),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:"{10-17}","{10-17}":!0},"// src/game.rs inside impl Game {} block\n    pub fn update(&mut self) {\n        self.frame_count += 1;\n\n        if self.frame_count % 15 == 0 {\n            self.snake.update();\n        }\n        self.snake.draw();\n\n        wasm4::blit(\n            &FRUIT_SPRITE,\n            self.fruit.x * 8,\n            self.fruit.y * 8,\n            8,\n            8,\n            wasm4::BLIT_2BPP,\n        );\n    }\n")),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust",metastring:"{10}","{10}":!0},"// src/game.rs inside impl Game {} block\n    pub fn update(&mut self) {\n        self.frame_count += 1;\n\n        if self.frame_count % 15 == 0 {\n            self.snake.update();\n        }\n        self.snake.draw();\n\n        set_draw_color(0x4320);\n        wasm4::blit(\n            &FRUIT_SPRITE,\n            self.fruit.x * 8,\n            self.fruit.y * 8,\n            8,\n            8,\n            wasm4::BLIT_2BPP,\n        );\n    }\n")),(0,r.kt)("p",null,"This way, w4 uses the color palette in its default configuration. Except for one thing: The background will be transparent.")),(0,r.kt)(o.T,{value:"wat",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the ",(0,r.kt)("inlineCode",{parentName:"p"},"blit")," function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},';; Copies pixels to the framebuffer.\n(import "env" "blit" (func $blit (param i32 i32 i32 i32 i32 i32)))\n')),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},'(func (export "update")\n  ...\n\n  ;; Draw fruit.\n  (call $blit\n    (i32.const 0x2638)\n    (i32.mul (i32.load (i32.const 0x2630)) (i32.const 8))\n    (i32.mul (i32.load (i32.const 0x2634)) (i32.const 8))\n    (i32.const 8)\n    (i32.const 8)\n    (i32.const 1))\n)\n')),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasm"},'(func (export "update")\n  ...\n\n  ;; Set fruit colors.\n  (i32.store16 (global.get $DRAW_COLORS) (i32.const 0x4320))\n\n  ;; Draw fruit.\n  (call $blit\n    (i32.const 0x2638)\n    (i32.mul (i32.load (i32.const 0x2630)) (i32.const 8))\n    (i32.mul (i32.load (i32.const 0x2634)) (i32.const 8))\n    (i32.const 8)\n    (i32.const 8)\n    (i32.const 1))\n)\n')),(0,r.kt)("p",null,"This way, w4 uses the color palette in it's default configuration. Except for one thing: The background will be transparent.")),(0,r.kt)(o.T,{value:"zig",mdxType:"Page"},(0,r.kt)("p",null,"Rendering the sprite is rather simple. Just call the ",(0,r.kt)("inlineCode",{parentName:"p"},"blit")," function of w4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig"},"/// Copies pixels to the framebuffer.\npub extern fn blit(sprite: [*]const u8, x: i32, y: i32, width: i32, height: i32, flags: u32) void;\n")),(0,r.kt)("p",null,"In practice it looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{11}","{11}":!0},"export fn update() void {\n    frame_count += 1;\n\n    input();\n\n    if (frame_count % 15 == 0) {\n        snake.update();\n    }\n    snake.draw();\n\n    w4.blit(&fruit_sprite, fruit.x * 8, fruit.y * 8, 8, 8, w4.BLIT_2BPP);\n}\n")),(0,r.kt)("p",null,"But since you set the drawing colors, you need to change the drawing colors too:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{3}","{3}":!0},"    snake.draw();\n\n    w4.DRAW_COLORS.* = 0x4320;\n    w4.blit(&fruit_sprite, fruit.x * 8, fruit.y * 8, 8, 8, w4.BLIT_2BPP);\n")),(0,r.kt)("p",null,"This way, w4 uses the color palette in its default configuration. Except for one thing: The background will be transparent."))))}m.isMDXComponent=!0},6010:function(e,t,n){"use strict";function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:function(){return i}})},6221:function(e,t){"use strict";t.Z="data:image/webp;base64,UklGRmQAAABXRUJQVlA4TFcAAAAvP8APAAo1kSRFdlCHtnOHguGNNttihQKISiz5a0TREQgQZVLUSDbQ/wkYf7zrsq/XzUc/q5sGSFnWVbAKqWo5qKPgX97HWdbTeR0Zg+eCXtYP57iP6wUA"},987:function(e,t){"use strict";t.Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAAXNSR0IArs4c6QAAAAxQTFRF+/fz5bCDQm5dICg9JFHL+gAAAClJREFUCJk1iskNADAMwjj237mAUn9sIYAgYZxg2TNFum6kEuSf5pR7fgkLAEyswVwtAAAAAElFTkSuQmCC"}}]);