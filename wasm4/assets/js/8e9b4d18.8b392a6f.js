(self.webpackChunksite=self.webpackChunksite||[]).push([[9477],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return p}});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var r=a.createContext({}),u=function(e){var n=a.useContext(r),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(r.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},f=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),f=u(t),p=o,h=f["".concat(r,".").concat(p)]||f[p]||d[p]||i;return t?a.createElement(h,s(s({ref:n},c),{},{components:t})):a.createElement(h,s({ref:n},c))}));function p(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,s=new Array(i);s[0]=f;var l={};for(var r in n)hasOwnProperty.call(n,r)&&(l[r]=n[r]);l.originalType=e,l.mdxType="string"==typeof e?e:o,s[1]=l;for(var u=2;u<i;u++)s[u]=t[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}f.displayName="MDXCreateElement"},6742:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var a=t(9756),o=t(7294),i=t(3727),s=t(2263),l=t(3919),r=t(412),u=(0,o.createContext)({collectLink:function(){}}),c=t(4996),d=t(8780),f=["isNavLink","to","href","activeClassName","isActive","data-noBrokenLinkCheck","autoAddBaseUrl"];var p=function(e){var n,t,p=e.isNavLink,h=e.to,k=e.href,m=e.activeClassName,y=e.isActive,g=e["data-noBrokenLinkCheck"],b=e.autoAddBaseUrl,v=void 0===b||b,w=(0,a.Z)(e,f),N=(0,s.Z)().siteConfig,x=N.trailingSlash,O=N.baseUrl,T=(0,c.C)().withBaseUrl,_=(0,o.useContext)(u),C=h||k,P=(0,l.Z)(C),$=null==C?void 0:C.replace("pathname://",""),D=void 0!==$?(t=$,v&&function(e){return e.startsWith("/")}(t)?T(t):t):void 0;D&&P&&(D=(0,d.applyTrailingSlash)(D,{trailingSlash:x,baseUrl:O}));var B,E=(0,o.useRef)(!1),S=p?i.OL:i.rU,j=r.Z.canUseIntersectionObserver;(0,o.useEffect)((function(){return!j&&P&&null!=D&&window.docusaurus.prefetch(D),function(){j&&B&&B.disconnect()}}),[D,j,P]);var A=null!==(n=null==D?void 0:D.startsWith("#"))&&void 0!==n&&n,q=!D||!P||A;return D&&P&&!A&&!g&&_.collectLink(D),q?o.createElement("a",Object.assign({href:D},C&&!P&&{target:"_blank",rel:"noopener noreferrer"},w)):o.createElement(S,Object.assign({},w,{onMouseEnter:function(){E.current||null==D||(window.docusaurus.preload(D),E.current=!0)},innerRef:function(e){var n,t;j&&e&&P&&(n=e,t=function(){null!=D&&window.docusaurus.prefetch(D)},(B=new window.IntersectionObserver((function(e){e.forEach((function(e){n===e.target&&(e.isIntersecting||e.intersectionRatio>0)&&(B.unobserve(n),B.disconnect(),t())}))}))).observe(n))},to:D||""},p&&{isActive:y,activeClassName:m}))}},3919:function(e,n,t){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function o(e){return void 0!==e&&!a(e)}t.d(n,{b:function(){return a},Z:function(){return o}})},4996:function(e,n,t){"use strict";t.d(n,{C:function(){return i},Z:function(){return s}});var a=t(2263),o=t(3919);function i(){var e=(0,a.Z)().siteConfig,n=(e=void 0===e?{}:e).baseUrl,t=void 0===n?"/":n,i=e.url;return{withBaseUrl:function(e,n){return function(e,n,t,a){var i=void 0===a?{}:a,s=i.forcePrependBaseUrl,l=void 0!==s&&s,r=i.absolute,u=void 0!==r&&r;if(!t)return t;if(t.startsWith("#"))return t;if((0,o.b)(t))return t;if(l)return n+t;var c=t.startsWith(n)?t:n+t.replace(/^\//,"");return u?e+c:c}(i,t,e,n)}}}function s(e,n){return void 0===n&&(n={}),(0,i().withBaseUrl)(e,n)}},9443:function(e,n,t){"use strict";var a=(0,t(7294).createContext)(void 0);n.Z=a},8802:function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){var t=n.trailingSlash,a=n.baseUrl;if(e.startsWith("#"))return e;if(void 0===t)return e;var o,i=e.split(/[#?]/)[0],s="/"===i||i===a?i:(o=i,t?function(e){return e.endsWith("/")?e:e+"/"}(o):function(e){return e.endsWith("/")?e.slice(0,-1):e}(o));return e.replace(i,s)}},8780:function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.uniq=n.applyTrailingSlash=void 0;var o=t(8802);Object.defineProperty(n,"applyTrailingSlash",{enumerable:!0,get:function(){return a(o).default}});var i=t(9964);Object.defineProperty(n,"uniq",{enumerable:!0,get:function(){return a(i).default}})},9964:function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return Array.from(new Set(e))}},2375:function(e,n,t){"use strict";t.d(n,{T:function(){return f},Z:function(){return p}});var a=t(7294),o=t(6742),i=t(5977),s=t(6010),l=t(9443);var r=function(){var e=(0,a.useContext)(l.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},u={assemblyscript:"AssemblyScript",c:"C / C++",c3:"C3",d:"D",go:"Go",grain:"Grain",nelua:"Nelua",nim:"Nim",odin:"Odin",penne:"Penne",porth:"Porth",roland:"Roland",rust:"Rust",wat:"WebAssembly Text",zig:"Zig"};function c(e){return"string"==typeof e&&Object.prototype.hasOwnProperty.call(u,e)}function d(e){return(null!=e?e:"").trim().toLowerCase()}function f(e){var n=e.children,t=e.hidden,o=e.className;return a.createElement("div",{hidden:t,className:o},n)}function p(e){var n=a.Children.toArray(e.children),t=n.map((function(e){return e.props.value})),l=function(){var e=r(),n=e.tabGroupChoices,t=e.setTabGroupChoices,o=(0,a.useState)("assemblyscript"),i=o[0],s=o[1],l=function(e){var n=c(e);n?(s(e),t("language",e)):n||console.warn('MultilanguageCode: invalid code-lang received: "'+e+'"')},u=(0,a.useRef)(l);(0,a.useEffect)((function(){u.current=l}));var f="undefined"!=typeof window?window.location.search:"",p=n.language;return(0,a.useLayoutEffect)((function(){var e=d(p);c(e)&&s(e)}),[p]),(0,a.useEffect)((function(){var e=d(new URLSearchParams(f).get("code-lang"));c(e)&&u.current(e)}),[f]),{activeLang:i,updateLang:l}}().activeLang,f=(0,i.k6)(),p=t.includes(l)?l:t.includes("assemblyscript")?"assemblyscript":t[0],h=a.createElement("div",{className:"dropdown dropdown--hoverable dropdown--right"},a.createElement("a",{className:"navbar__link"},u[p]," "),a.createElement("ul",{className:"dropdown__menu text--left"},Object.entries(u).filter((function(e){return t.includes(e[0])})).map((function(e){var n=e[0],t=e[1],i=f.location.pathname+"?code-lang="+n+(f.location.hash||"#no-scroll");return a.createElement("li",{key:n},a.createElement(o.Z,{to:i,replace:!0,className:(0,s.Z)("dropdown__link",n===p&&"dropdown__link--active")},t))}))));return a.createElement("div",null,a.createElement("div",{className:"multilang"},h),a.createElement("div",null,n.map((function(e){return(0,a.cloneElement)(e,{key:e.props.value,hidden:e.props.value!==p})}))))}},1104:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return r},contentTitle:function(){return u},metadata:function(){return c},toc:function(){return d},default:function(){return p}});var a=t(2122),o=t(9756),i=(t(7294),t(3905)),s=t(2375),l=["components"],r={},u="Collision Detection",c={unversionedId:"tutorials/snake/collision-detection",id:"tutorials/snake/collision-detection",isDocsHomePage:!1,title:"Collision Detection",description:'Your game is progressing nicely. Only two more things and you\'re done: Growing the snake and "Game Over". For the first, you need to check if the snake collides with the fruit. For the second, you need to check if the snake collides with itself.',source:"@site/docs/tutorials/snake/collision-detection.md",sourceDirName:"tutorials/snake",slug:"/tutorials/snake/collision-detection",permalink:"/wasm4/docs/tutorials/snake/collision-detection",editUrl:"https://github.com/aduros/wasm4/edit/main/site/docs/tutorials/snake/collision-detection.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Placing the Fruit",permalink:"/wasm4/docs/tutorials/snake/placing-the-fruit"},next:{title:"Further Ideas",permalink:"/wasm4/docs/tutorials/snake/further-ideas"}},d=[{value:"Collision Detection with the Fruit",id:"collision-detection-with-the-fruit",children:[]},{value:"Collision Detection with Itself",id:"collision-detection-with-itself",children:[]}],f={toc:d};function p(e){var n=e.components,t=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},f,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"collision-detection"},"Collision Detection"),(0,i.kt)("p",null,'Your game is progressing nicely. Only two more things and you\'re done: Growing the snake and "Game Over". For the first, you need to check if the snake collides with the fruit. For the second, you need to check if the snake collides with itself.'),(0,i.kt)("h2",{id:"collision-detection-with-the-fruit"},"Collision Detection with the Fruit"),(0,i.kt)("p",null,"Collision detection can be one of the harder to understand concepts of game development. Lucky for you, this is not the case this time. This game is using a 20x20 grid. Each cell can either be occupied or free. To check this, you can compare the X and Y values of the 2 entities that are checked."),(0,i.kt)(s.Z,{mdxType:"MultiLanguage"},(0,i.kt)(s.T,{value:"assemblyscript",mdxType:"Page"},(0,i.kt)("p",null,"A simple"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"if (snake.body[0].equals(fruit)) {\n    // Snake's head hits the fruit\n}\n")),(0,i.kt)("p",null,'is enough already to check if the snake eats the fruit. And to make the snake "grow", simply increase the length of the snake using the ',(0,i.kt)("inlineCode",{parentName:"p"},"push")," function of the array. Now it remains the question what values should this new piece have. The easiest would be to add the current last piece:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"let tail = snake.body[snake.body.length - 1]\nsnake.body.push(new Point(tail.x, tail.y))\n")),(0,i.kt)("p",null,"Once this done, simply relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"fruit.X = rnd(20)\nfruit.Y = rnd(20)\n")),(0,i.kt)("p",null,"In its final form, it could look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{4-9}","{4-9}":!0},"    if (frameCount % 15 == 0) {\n        snake.update()\n\n        if (snake.body[0].equals(fruit)) {\n            let tail = snake.body[snake.body.length - 1]\n            snake.body.push(new Point(tail.x, tail.y))\n            fruit.x = rnd(20)\n            fruit.y = rnd(20)\n        }\n    }\n")),(0,i.kt)("p",null,'Now you\'re almost done. Only "Game Over" is left to finish this game.')),(0,i.kt)(s.T,{value:"c",mdxType:"Page"},(0,i.kt)("p",null," In our ",(0,i.kt)("inlineCode",{parentName:"p"},"update")," function in ",(0,i.kt)("inlineCode",{parentName:"p"},"main.c")," after calling ",(0,i.kt)("inlineCode",{parentName:"p"},"snake_update"),", an if statement comparing the location of the snake's head with the location of the fruit"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"if(snake.body[0].x == fruit.x && snake.body[0].y == fruit.y)\n{\n  //snake's head hits the fruit\n}\n")),(0,i.kt)("p",null,"is enough already to check if the snake eats the fruit. To add to the snake we will create a copy of the snake's last body part, and add it to the snake using ",(0,i.kt)("inlineCode",{parentName:"p"},"snake_push"),", and then relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"if(snake.body[0].x == fruit.x && snake.body[0].y == fruit.y)\n{\n  struct point p = snake.body[snake.length-1];\n  snake_push(&snake,p);\n  fruit.x = rand()%20;\n  fruit.y = rand()%20;\n}\n")),(0,i.kt)("p",null,'Now you\'re almost done. Only "Game Over" is left to finish this game.')),(0,i.kt)(s.T,{value:"d",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"go",mdxType:"Page"},(0,i.kt)("p",null," A simple"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"if snake.Body[0].X == fruit.X && snake.Body[0].Y == fruit.Y {\n    // Snake's head hits the fruit\n}\n")),(0,i.kt)("p",null,'is enough already to check if the snake eats the fruit. And to make the snake "grow", simply increase the length of the snake using the ',(0,i.kt)("inlineCode",{parentName:"p"},"append")," function of Go. Now it remains the question what values should this new piece have. The easiest would be to add the current last piece:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"snake.Body = append(snake.Body, snake.Body[len(snake.Body)-1])\n")),(0,i.kt)("p",null,"Once this done, simply relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"fruit.X = rnd(20)\nfruit.Y = rnd(20)\n")),(0,i.kt)("p",null,"In its final form, it could look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"{4-8}","{4-8}":!0},"    if frameCount%15 == 0 {\n        snake.Update()\n\n        if snake.Body[0].X == fruit.X && snake.Body[0].Y == fruit.Y {\n            snake.Body = append(snake.Body, snake.Body[len(snake.Body)-1])\n            fruit.X = rnd(20)\n            fruit.Y = rnd(20)\n        }\n    }\n")),(0,i.kt)("p",null,'Now you\'re almost done. Only "Game Over" is left to finish this game.')),(0,i.kt)(s.T,{value:"nelua",mdxType:"Page"},(0,i.kt)("p",null,"A simple"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"if snake.body[1] == fruit then\n  -- Snake's head hits the fruit\nend\n")),(0,i.kt)("p",null,'is enough already to check if the snake eats the fruit. And to make the snake "grow", simply increase the length of the snake using the ',(0,i.kt)("inlineCode",{parentName:"p"},"push")," function of the sequence. Now it remains the question what values should this new piece have. The easiest would be to add the current last piece:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local tail = snake.body[#snake.body]\nsnake.body:push({ x = tail.x, y = tail.y })\n")),(0,i.kt)("p",null,"Once this done, simply relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"fruit = { x = math.random(0, 19), y = math.random(0,19) }\n")),(0,i.kt)("p",null,"Just this however will reallocate the fruit in the same places for every run because it uses always the same seed, to generate a random seed we need to call ",(0,i.kt)("inlineCode",{parentName:"p"},"math.randomseed")," function with at least one argument, which can be ",(0,i.kt)("inlineCode",{parentName:"p"},"frame_count"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"math.randomseed(frame_count)\n")),(0,i.kt)("p",null,"In its final form, it could look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{4-9}","{4-9}":!0},"  if frame_count % 15 == 0 then\n    snake:update()\n\n    if snake.body[1] == fruit then\n      local tail = snake.body[#snake.body]\n      snake.body:push({ x = tail.x, y = tail.y })\n      math.randomseed(frame_count)\n      fruit = { x = math.random(0, 19), y = math.random(0,19) }\n    end\n  end\n")),(0,i.kt)("p",null,'Now you\'re almost done. Only "Game Over" is left to finish this game.')),(0,i.kt)(s.T,{value:"nim",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"odin",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"porth",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"rust",mdxType:"Page"},(0,i.kt)("p",null,"A simple"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"if self.snake.body[0] == fruit {\n    // Snake's head hits the fruit\n}\n")),(0,i.kt)("p",null,'is enough already to check if the snake eats the fruit. And to make the snake "grow", simply increase the length of the snake using the ',(0,i.kt)("a",{parentName:"p",href:"https://doc.rust-lang.org/std/vec/struct.Vec.html#method.push"},(0,i.kt)("inlineCode",{parentName:"a"},"push"))," method. Now it remains the question what values should this new piece have. The easiest would be to add the current last piece:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"// src/game.rs\nlet dropped_pos = self.snake.update();\n\nif self.snake.body[0] == self.fruit {\n    if let Some(last_pos) = dropped_pos {\n        self.snake.body.push(last_pos);\n    }\n}\n")),(0,i.kt)("p",null,"Once this done, simply relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"// src/game.rs\nself.fruit.x = self.rng.i32(0..20);\nself.fruit.y = self.rng.i32(0..20);\n")),(0,i.kt)("p",null,"In its final form, it could look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"// src/game.rs inside impl Game {} block\n    pub fn update(&mut self) {\n        self.frame_count += 1;\n\n        self.input();\n\n        if self.frame_count % 15 == 0 {\n            let dropped_pos = self.snake.update();\n\n            if self.snake.body[0] == self.fruit {\n                if let Some(last_pos) = dropped_pos {\n                    self.snake.body.push(last_pos);\n                }\n\n                self.fruit.x = self.rng.i32(0..20);\n                self.fruit.y = self.rng.i32(0..20);\n            }\n        }\n    }\n"))),(0,i.kt)(s.T,{value:"wat",mdxType:"Page"},(0,i.kt)("p",null,"The following"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasm"},";; if (body[0].x == fruit.x && body[0].y == fruit.y)\n(if (i32.and\n      (i32.eq (i32.load (i32.const 0x19ac)) (i32.load (i32.const 0x2630)))\n      (i32.eq (i32.load (i32.const 0x19b0)) (i32.load (i32.const 0x2634))))\n  (then\n    ;; Snake's head hits the fruit\n  )\n)\n")),(0,i.kt)("p",null,'is enough already to check if the snake eats the fruit. And to make the snake "grow", simply increase the length and add a new piece to the body. Now it remains the question what values should this new piece have. The easiest would be to add the current last piece:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasm"},"(local $body-length i32)\n(local $tail-offset i32)\n(local $tail-x i32)\n(local $tail-y i32)\n\n;; tail-offset = (body-length - 1) * 8\n(local.set $tail-offset\n  (i32.mul\n    (i32.sub\n      (local.tee $body-length\n        (i32.load (i32.const 0x19a8)))\n      (i32.const 1))\n    (i32.const 8)))\n\n;; Increment body_length\n(i32.store\n  (i32.const 0x19a8)\n  (i32.add\n    (local.get $body-length)\n    (i32.const 1)))\n\n;; Copy tail to next point in body.\n(i32.store offset=0x19b4 (local.get $tail-offset) (i32.load (i32.const 0x19ac)))\n(i32.store offset=0x19b8 (local.get $tail-offset) (i32.load (i32.const 0x19b0)))\n")),(0,i.kt)("p",null,"Once this done, simply relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasm"},";; fruit.x = rnd(20);\n(i32.store (i32.const 0x2630) (call $rnd (i32.const 20)))\n;; fruit.y = rnd(20);\n(i32.store (i32.const 0x2634) (call $rnd (i32.const 20)))\n")),(0,i.kt)("p",null,"In it's final form, it could look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasm"},"  (local $body-length i32)\n  (local $tail-offset i32)\n  (local $tail-x i32)\n  (local $tail-y i32)\n\n  ...\n\n  (if (i32.eqz (i32.rem_u (global.get $frame-count) (i32.const 15)))\n    (then\n      (call $snake-update)\n\n      ;; if (body[0].x == fruit.x && body[0].y == fruit.y)\n      (if (i32.and\n            (i32.eq (i32.load (i32.const 0x19ac)) (i32.load (i32.const 0x2630)))\n            (i32.eq (i32.load (i32.const 0x19b0)) (i32.load (i32.const 0x2634))))\n        (then\n          ;; Snake's head hits the fruit\n\n          ;; tail-offset = (body-length - 1) * 8\n          (local.set $tail-offset\n            (i32.mul\n              (i32.sub\n                (local.tee $body-length\n                  (i32.load (i32.const 0x19a8)))\n                (i32.const 1))\n              (i32.const 8)))\n\n          ;; Increment body_length\n          (i32.store\n            (i32.const 0x19a8)\n            (i32.add\n              (local.get $body-length)\n              (i32.const 1)))\n\n          ;; Copy tail to next point in body.\n          (i32.store offset=0x19b4 (local.get $tail-offset)\n            (i32.load offset=0x19ac (local.get $tail-offset)))\n          (i32.store offset=0x19b8 (local.get $tail-offset)\n            (i32.load offset=0x19b0 (local.get $tail-offset)))\n\n          ;; fruit.x = rnd(20);\n          (i32.store (i32.const 0x2630) (call $rnd (i32.const 20)))\n          ;; fruit.y = rnd(20);\n          (i32.store (i32.const 0x2634) (call $rnd (i32.const 20)))\n        )\n      )\n    )\n  )\n")),(0,i.kt)("p",null,'Now you\'re almost done. Only "Game Over" is left to finish this game.')),(0,i.kt)(s.T,{value:"zig",mdxType:"Page"},(0,i.kt)("p",null,"A simple"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-zig"},"if (snake.body.get(0).equals(fruit)) {\n    // Snake's head hits the fruit\n}\n")),(0,i.kt)("p",null,'is enough already to check if the snake eats the fruit. And to make the snake "grow", simply increase the length of the snake using the ',(0,i.kt)("inlineCode",{parentName:"p"},"push")," function of the array. Now it remains the question what values should this new piece have. The easiest would be to add the current last piece:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-zig"},'const tail = snake.body.get(snake.body.len-1);\nsnake.body.append(Point.init(tail.x, tail.y)) catch @panic("couldn\'t grow snake");\n')),(0,i.kt)("p",null,"Once this done, simply relocate the fruit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-zig"},"fruit.x = rnd(20);\nfruit.y = rnd(20);\n")),(0,i.kt)("p",null,"In its final form, it could look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{4-9}","{4-9}":!0},'    if (frame_count % 15 == 0) {\n        snake.update();\n\n        if (snake.body.get(0).equals(fruit)) {\n            const tail = snake.body.get(snake.body.len - 1);\n            snake.body.append(Point.init(tail.x, tail.y)) catch @panic("couldn\'t grow snake");\n            fruit.x = rnd(20);\n            fruit.y = rnd(20);\n        }\n    }\n')),(0,i.kt)("p",null,'Now you\'re almost done. Only "Game Over" is left to finish this game.'))),(0,i.kt)("h2",{id:"collision-detection-with-itself"},"Collision Detection with Itself"),(0,i.kt)("p",null,'For the player to have any sense of "danger", the game needs a possibility for the player to lose. Usually the snake can\'t touch itself or it dies. For this, just loop through the body and check if the piece and the head have the same coordinates. Just like with the fruit. But it might be a good idea to move this to its own function:'),(0,i.kt)(s.Z,{mdxType:"MultiLanguage"},(0,i.kt)(s.T,{value:"assemblyscript",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"    isDead(): bool {\n        const head = this.body[0]\n        for (let i = 1, len = this.body.length; i < len; i++) {\n            if (this.body[i].equals(head)) {\n                return true\n            }\n        }\n\n        return false\n    }\n")),(0,i.kt)("p",null,"Now you can call this function to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{4-6}","{4-6}":!0},"    if (frameCount % 15 == 0) {\n        snake.update()\n\n        if (snake.isDead()) {\n            // Do something\n        }\n\n        if (snake.body[0].equals(fruit)) {\n            let tail = snake.body[snake.body.length - 1]\n            snake.body.push(new Point(tail.x, tail.y))\n            fruit.x = rnd(20)\n            fruit.y = rnd(20)\n        }\n    }\n")),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game. Up to you.")),(0,i.kt)(s.T,{value:"c",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"int snake_isdead(struct snake *snake)\n{\n    for(size_t i = 1; i < snake->length; i++)\n    {\n        if(snake->body[i].x == snake->body[0].x && snake->body[i].y == snake->body[0].y)\n        {\n            return 1;\n        }\n    }\n\n    return 0;\n}\n")),(0,i.kt)("p",null,"Add the above function to the ",(0,i.kt)("inlineCode",{parentName:"p"},"snake.c")," file and add a corresponding declaration to ",(0,i.kt)("inlineCode",{parentName:"p"},"snake.h"),"."),(0,i.kt)("p",null,"Now you can call this function from ",(0,i.kt)("inlineCode",{parentName:"p"},"update")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"main.c"),"to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c",metastring:"{5-8}","{5-8}":!0},"    if (frame_count % 15 == 0)\n    {\n        snake_update(&snake);\n\n        if(snake_isdead(&snake))\n        {\n          //snake is dead\n        }\n\n        if(snake.body[0].x == fruit.x && snake.body[0].y == fruit.y)\n        {\n            struct point p = snake.body[snake.length-1];\n            snake_push(&snake,p);\n            fruit.x = rand()%20;\n            fruit.y = rand()%20;\n        }\n    }\n\n")),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"    if (frame_count % 15 == 0)\n    {\n        snake_update(&snake);\n\n        if(snake_isdead(&snake))\n        {\n            snake_create(&snake);\n           \n            snake_push(&snake,(struct point){2,0}); \n            snake_push(&snake,(struct point){1,0});\n            snake_push(&snake,(struct point){0,0});\n\n            snake.direction = (struct point){1,0};\n        }\n\n        if(snake.body[0].x == fruit.x && snake.body[0].y == fruit.y)\n        {\n            struct point p = snake.body[snake.length-1];\n            snake_push(&snake,p);\n            fruit.x = rand()%20;\n            fruit.y = rand()%20;\n        }\n    }\n"))),(0,i.kt)(s.T,{value:"d",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"go",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"func (s *Snake) IsDead() bool {\n    for index := 1; index < len(s.Body)-1; index++ {\n        if s.Body[0].X == s.Body[index].X && s.Body[0].Y == s.Body[index].Y {\n            return true\n        }\n    }\n\n    return false\n}\n")),(0,i.kt)("p",null,"Now you can call this function to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"{4-6}","{4-6}":!0},"    if frameCount%15 == 0 {\n        snake.Update()\n\n        if snake.IsDead() {\n            // Do something\n        }\n\n        if snake.Body[0].X == fruit.X && snake.Body[0].Y == fruit.Y {\n            snake.Body = append(snake.Body, snake.Body[len(snake.Body)-1])\n            fruit.X = rnd(20)\n            fruit.Y = rnd(20)\n        }\n    }\n")),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game. Up to you.")),(0,i.kt)(s.T,{value:"nelua",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"function Snake:is_dead(): boolean\n  local head = self.body[1]\n\n  for i = 2, #self.body do\n    if self.body[i] == head then\n      return true\n    end\n  end\n\n  return false\nend\n")),(0,i.kt)("p",null,"Now you can call this function to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua",metastring:"{4-6}","{4-6}":!0},"  if frame_count % 15 == 0 then\n    snake:update()\n\n    if snake:is_dead() then\n      -- Do something\n    end\n\n    if snake.body[1] == fruit then\n      local tail = snake.body[#snake.body]\n      snake.body:push({ x = tail.x, y = tail.y })\n      math.randomseed(frame_count)\n      fruit = { x = math.random(0, 19), y = math.random(0,19) }\n    end\n  end\n")),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game. Up to you.")),(0,i.kt)(s.T,{value:"nim",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"odin",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"porth",mdxType:"Page"},(0,i.kt)("p",null,"// TODO")),(0,i.kt)(s.T,{value:"rust",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"// src/snake.rs inside impl Snake {} block\n    pub fn is_dead(&self) -> bool {\n        self.body\n            .iter()\n            .skip(1)\n            .any(|&body_section| body_section == self.body[0])\n    }\n")),(0,i.kt)("p",null,"Now you can call this function to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"// src/game.rs inside impl Game {} block\n    pub fn update(&mut self) {\n        self.frame_count += 1;\n\n        self.input();\n\n        if (self.snake.is_dead()) {\n            // Do something\n        }\n\n        if self.frame_count % 15 == 0 {\n            let dropped_pos = self.snake.update();\n\n            if self.snake.body[0] == self.fruit {\n                if let Some(last_pos) = dropped_pos {\n                    self.snake.body.push(last_pos);\n                }\n\n                self.fruit.x = self.rng.i32(0..20);\n                self.fruit.y = self.rng.i32(0..20);\n            }\n        }\n    }\n")),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game. Up to you.")),(0,i.kt)(s.T,{value:"wat",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasm"},"(func $snake-is-dead (result i32)\n  (local $offset i32)\n  (local $offset-end i32)\n\n  ;; offset = 8\n  (local.set $offset (i32.const 8))\n\n  ;; offset-end = body_length * 8\n  (local.set $offset-end\n    (i32.mul\n      (i32.load (i32.const 0x19a8))  ;; body_length\n      (i32.const 8)))\n\n  ;; loop over all points in the body (except the head)\n  (loop $loop\n    ;; If the head is at the same place as this piece of the body, then return\n    ;; true.\n    (if (i32.and\n          (i32.eq\n            (i32.load (i32.const 0x19ac))\n            (i32.load offset=0x19ac (local.get $offset)))\n          (i32.eq\n            (i32.load (i32.const 0x19b0))\n            (i32.load offset=0x19b0 (local.get $offset))))\n      (then\n        (return (i32.const 1))))\n\n    ;; Add 8 to offset, and loop if offset < offset-end.\n    (br_if $loop\n      (i32.lt_u\n        (local.tee $offset (i32.add (local.get $offset) (i32.const 8)))\n        (local.get $offset-end)))\n  )\n\n  ;; return false\n  (i32.const 0)\n)\n")),(0,i.kt)("p",null,"Now you can call this function to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-wasm"},"    (call $snake-update)\n\n    (if (call $snake-is-dead)\n      (then\n        ;; Do something\n      )\n    )\n")),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game. Up to you.")),(0,i.kt)(s.T,{value:"zig",mdxType:"Page"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-zig"},"    pub fn isDead(this: *@This()) bool {\n        const head = this.body.get(0);\n        for (this.body.constSlice(), 0..) |part, i| {\n            if (i == 0) continue;\n            if (part.equals(head)) return true;\n        }\n\n        return false;\n    }\n")),(0,i.kt)("p",null,"Now you can call this function to check if the snake died in this frame:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-zig",metastring:"{4-6}","{4-6}":!0},'    if (frame_count % 15 == 0) {\n        snake.update();\n\n        if (snake.isDead()) {\n            // Do something\n        }\n\n        if (snake.body.get(0).equals(fruit)) {\n            const tail = snake.body.get(snake.body.len - 1);\n            snake.body.append(Point.init(tail.x, tail.y)) catch @panic("couldn\'t grow snake");\n            fruit.x = rnd(20);\n            fruit.y = rnd(20);\n        }\n    }\n')),(0,i.kt)("p",null,"What you do, is up to you. You could stop the game and show the score. Or you could simply reset the game. Up to you."))))}p.isMDXComponent=!0},6010:function(e,n,t){"use strict";function a(e){var n,t,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=a(e[n]))&&(o&&(o+=" "),o+=t);else for(n in e)e[n]&&(o&&(o+=" "),o+=n);return o}function o(){for(var e,n,t=0,o="";t<arguments.length;)(e=arguments[t++])&&(n=a(e))&&(o&&(o+=" "),o+=n);return o}t.d(n,{Z:function(){return o}})}}]);